<%- include("head"); %>
    <%- include("styles_gral"); %>

        <div class="col-md-12" id="body_lista" name="body_lista" style="margin-top: 10px;">


            <div class="col-md-12">

                <div>
                    <span class="titulo-tabla" style="font-weight: bold;text-align: left;">
                        <h2> Mis Registros de Indicadores</h2>
                    </span>
                </div>



                <div class="table-responsive">

                    <table class="table table-striped table-bordered" id="tbl_reg_indicador">


                        <thead class="head-tabla-reg">
                            <tr>
                                <th>#</th>
                                <th>Fecha</th>
                                <th>Vigencia</th>
                                <th>Periodo</th>
                                <th>Profesional</th>
                                <th>Area</th>
                                <th>Tipo Meta</th>
                                <th>Numerador</th>
                                <th>Denominador</th>
                                <th>Nota</th>
                                <th>Indicador</th>
                                <th>Versi√≥n</th>
                                <th>Calificado</th>
                                <th>Aprobado</th>
                                <th>Acciones</th>

                            </tr>
                        </thead>
                        <tbody id="developers">
                            <% for(var i=0; i<lista_registro_indicadores.length; i++) { %>

                                <tr class="text-justify sorting_1" style="font-size: 0.8em; line-height: 1.4em;">
                                    <td>
                                        <%= i+1 %>

                                    </td>
                                    <td>
                                        <%= lista_registro_indicadores[i].fecharegistro %>
                                    </td>
                                    <td>
                                        <input name="txt_vigencia" id="txt_vigencia" value='<%= lista_registro_indicadores[i].vigencia %>' type="text" hidden>
                                        <%= lista_registro_indicadores[i].vigencia %>
                                    </td>

                                    <td>
                                        <input name="txt_periodo" id="txt_periodo" value='<%= lista_registro_indicadores[i].periodoevaluado %>' hidden>
                                        <%= lista_registro_indicadores[i].nombre_mes %>
                                    </td>
                                    <td>
                                        <input name="txt_id_profesional" id="txt_id_profesional" value='<%= lista_registro_indicadores[i].id_profesional %>' hidden>
                                        <%= lista_registro_indicadores[i].nombre_profesional %>
                                    </td>
                                    <td>
                                        <%= lista_registro_indicadores[i].nombre_area %>
                                    </td>

                                    <td>
                                        <%= lista_registro_indicadores[i].tipo_meta %>
                                    </td>

                                    <td>
                                        <%= lista_registro_indicadores[i].formula_cifras_numerador %>
                                    </td>
                                    <td>
                                        <%= lista_registro_indicadores[i].formula_cifras_denominador %>
                                    </td>

                                    <td>
                                        <%= lista_registro_indicadores[i].observaciones %>
                                    </td>

                                    <td>
                                        <input name="txt_id_indicador" id="txt_id_indicador" value='<%= lista_registro_indicadores[i].id_indicador %>' hidden>
                                        <%= lista_registro_indicadores[i].nombre_indicador %>
                                    </td>

                                    <td class="text-center" style="font-weight: bold;">
                                        <%= lista_registro_indicadores[i].version %>
                                    </td>

                                    <td class="text-center">

                                        <%if(lista_registro_indicadores[i].calificado){%>
                                            <strong><label style="color: green;"> S I</label></strong>
                                            <%}else{%>
                                                <strong><label style="color: red;"> N O</label></strong>
                                                <%}%>
                                    </td>



                                    <td id="<%= lista_registro_indicadores[i].id_registroindicador %>" name="<%= lista_registro_indicadores[i].id_registroindicador %>">
                                        <!--Se debera verificar si el id registro indicador ya fue calificado para
                                        seteaer el siguiente estado-->
                                        <script type="text/javascript">
                                            event.preventDefault();
                                            const peticion = "/consultar-calificacion-reg-indicador/?id_reg_indicador=" + '<%= lista_registro_indicadores[i].id_registroindicador %>';
                                            $.ajax({
                                                type: 'post',
                                                url: peticion,
                                                data: [],
                                                contentType: false,
                                                cache: false,
                                                processData: false,
                                                success: function(result) {
                                                    if (result.length != 0 && result[0].estado) {
                                                        $('#<%= lista_registro_indicadores[i].id_registroindicador %>').html('<i class="fas fa-check-circle text-center" onclick="" style="color: green;"> SI</i>');
                                                    } else {
                                                        $('#<%= lista_registro_indicadores[i].id_registroindicador %>').html("<i class='fas fa-minus-circle text-center' style='color: red;'' onclick=''></i>NO");
                                                    }

                                                }
                                            });
                                        </script>


                                    </td>

                                    <td class="btns-acciones">

                                        <%if(lista_registro_indicadores[i].calificado){%>

                                            <a href="" title="ver Detalle" style="color:blue" onclick="verDetalle('<%= lista_registro_indicadores[i].id_registroindicador %>')"><i class="far fa-eye"></i></a>
                                            <span class="vertical-line"></span>
                                            <a href="" title="Trazabilidad" style="color:blue" onclick="verTrazabilidad('<%= lista_registro_indicadores[i].id_indicador %>','<%= lista_registro_indicadores[i].id_profesional %>','<%= lista_registro_indicadores[i].vigencia %>','<%= lista_registro_indicadores[i].periodoevaluado %>')"><i class="fas fa-list-ol"></i></a>
                                            <span class="vertical-line"></span>
                                            <%}else{%>
                                                <a href="" title="ver Detalle" style="color:blue" onclick="verDetalle('<%= lista_registro_indicadores[i].id_registroindicador %>')"><i class="far fa-eye"></i></a>
                                                <span class="vertical-line"></span>
                                                <a href="" title="Trazabilidad" style="color:blue" onclick="verTrazabilidad('<%= lista_registro_indicadores[i].id_indicador %>','<%= lista_registro_indicadores[i].id_profesional %>','<%= lista_registro_indicadores[i].vigencia %>','<%= lista_registro_indicadores[i].periodoevaluado %>')"><i class="fas fa-list-ol"></i></a>
                                                <span class="vertical-line"></span>
                                                <a href="" title="Editar"><i class="fas fa-edit"></i></a>
                                                <span class="vertical-line"></span>
                                                <a href="" title="Eliminar" style="color: red;"><i class="far fa-trash-alt"></i></a>
                                                <span class="vertical-line"></span>
                                                <%}%>


                                    </td>

                                </tr>
                                <% }%>
                        </tbody>
                        <tfoot>

                        </tfoot>
                    </table>

                </div>
            </div>


            <script type="text/javascript">
                $(document).ready(function() {

                });


                function verDetalle(id_reg_indicador) {
                    event.preventDefault();
                    const peticion = "/form-ctm-visualizar-reg-indicador/?id_reg_indicador=" + id_reg_indicador;
                    $.ajax({
                        type: 'post',
                        url: peticion,
                        data: [],
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function(result) {
                            $('#body_ent').html(result);
                        }
                    });
                }

                function verTrazabilidad(id_indicador, profesional, vigencia, periodo) {
                    event.preventDefault();

                    var peticion_trazabilidad = "/obtener_trazabilidad_x_indicador_profesional_vigencia_periodo/?id_indicador=" + id_indicador +
                        "&profesional=" + profesional + "&vigencia=" + vigencia + "&periodo=" + periodo;
                    //select * from schema_control.registroindicadores where id_indicador=$1 and id_profesional=$2 and vigencia=$3 and periodoevaluado=$4
                    $.ajax({
                        type: 'get',
                        url: peticion_trazabilidad,
                        data: [],
                        contentType: false,
                        cache: false,
                        processData: false,
                        success: function(result) {
                            $("#body_lista").html("");
                            //$("#select_indicador").append('<option selected="selected">' + 'Seleccionar Indicador' + '</option>');
                            $("#body_lista").html(result);

                        }
                    });
                }
            </script>

            <style>
                .vertical-line {
                    display: inline-block;
                    border-left: 1px solid #ccc;
                    margin: 0 5px;
                    height: 10px;
                }
                
                body {
                    /*background-color: #eaedee;*/
                    overflow-x: auto;
                    overflow-y: auto;
                }
                
                body::-webkit-scrollbar {
                    display: auto;
                    overflow-y: hidden;
                }
                
                #tbl_reg_indicador {
                    font-size: small;
                    font-family: 'Montserrat', sans-serif;
                    border-spacing: 0px !important;
                    padding: 0px;
                }
                
                #tbl_reg_indicador th {
                    padding: 7px;
                }
                
                #tbl_reg_indicador td {
                    padding: 0;
                }
                
                .btns-acciones form .btn-submit {
                    font-family: 'Montserrat', sans-serif;
                    border-radius: 5px;
                    font-size: 10px;
                    border: none;
                    cursor: pointer;
                    transition: .3s ease all;
                    font-weight: bold;
                }
                
                #btn-elim-all {
                    font-family: 'Montserrat', sans-serif;
                    border-radius: 5px;
                    font-size: 10px;
                    border: none;
                    cursor: pointer;
                    transition: .3s ease all;
                }
                
                .head-tabla-reg {
                    background-color: #3f78da;
                    color: #fff;
                }
                
                .titulo-tabla {
                    color: #20488f;
                }
            </style>