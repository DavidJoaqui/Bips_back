<%- include("head"); %>
    <%- include("header"); %>
        <%- include("styles_gral"); %>


            <% const m=getMessages() %>

                <% if (m.notify) { %>

                    <div class="card" style="margin-top: 20px;" id="card-success">
                        <div class="card-header text-white bg-success mb-3 container-fluid" id="btn-cerrar-ok">
                            <strong>OK!</strong>
                            <button type="button" class="close" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="card-body">

                            <% m.notify.forEach((element)=> { %>

                                <%= element %>
                                    <% }) %> %>
                        </div>


                    </div>

                    <% } %>
                        <% if (m.error) { %>

                            <div class="card " style="margin-top: 20px;" id="">
                                <div class="card-header text-white bg-danger mb-3 container-fluid" id="btn-cerrar-err">
                                    <strong>Error!</strong>
                                    <button type="button" class="close" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                                <div class="card-body">

                                    <% m.error.forEach((element)=> { %>

                                        <%= element %>
                                            <% }) %> %>
                                </div>

                            </div>

                            <% } %>

                                <body id="body_ent">

                                    <div class="container-fluid" style="display: flex;justify-content: center;align-items: center;">
                                        <div class="col-md-4 col-md-offset-3">

                                            <div class="card border-dark container" style="margin-top:100px;margin-left: 30px; text-align: center;">


                                                <form id="formulario" enctype="multipart/form-data" method="POST">

                                                    <div class="well">
                                                        <div class="col-md-12" style="text-align: center;">
                                                            <h2 style="color: #20488f;font-size: 20px">Registro de nueva Entidad.
                                                            </h2>
                                                        </div>

                                                        <div class="form-group col-sm-12 col-md-12 col-xs-12">
                                                            <label for="" style="font-weight: bold;">Codigo de
                                                        entidad</label><br>

                                                            <input class="col-sm-12 col-md-12 col-xs-12" type="text" name="cod_entidad" id="cod_entidad" value="">

                                                        </div>

                                                        <div class="form-group col-sm-12 col-md-12 col-xs-12">
                                                            <label class="" style="font-weight: bold;"> Nombre de
                                                        entidad</label><br>

                                                            <input class="col-sm-12 col-md-12 col-xs-12" type="text" name="nombre_entidad" id="nombre_entidad" value="">

                                                        </div>

                                                        <div class="form-group col-sm-5 col-md-12">
                                                            <label style="font-weight: bold;">Regimen que aplica a la
                                                        entidad:</label>
                                                            <select class="form-select form-group form-control input-sm col-sm-12 col-md-12 col-xs-12" name="tipo_reg" id="tipo_reg" data-toggle="tooltip" title="Seleccionar Regimen!" data-placement="right" required>
                                                        <option selected="selected" value="">Seleccionar Regimen
                                                        </option>

                                                        <option value="C">Contributivo</option>
                                                        <option value="S">Subsidiado</option>
                                                        <option value="V">Vinculado</option>
                                                        <option value="E">Especial</option>
                                                        <option value="O">Otro</option>

                                                    </select>
                                                        </div>


                                                        <div class="form-group">
                                                            <div class="text-center">
                                                                <button style="font-weight: bold;" class="btn btn-success btn-sm" id="btn-validar" name="btn-validar" onclick="almacenar_registro()">Guardar
                                                            Registro</button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </body>


                                <script type="text/javascript">
                                    function almacenar_registro() {

                                        event.preventDefault();
                                        var cod_entidad = $('#cod_entidad').val();
                                        var nombre_entidad = $('#nombre_entidad').val();
                                        var tipo_reg = $('#tipo_reg').val();

                                        var peticion = "/persistir-entidad/?cod_entidad=" + cod_entidad + "&nombre_entidad=" + nombre_entidad + "&tipo_reg=" + tipo_reg;

                                        $.ajax({
                                            type: 'post',
                                            url: peticion,
                                            data: [],
                                            contentType: false,
                                            cache: false,
                                            processData: false,

                                            success: function(result) {

                                                history.replaceState("/config-entidades", "Nueva Entidad Bips", "/config-entidades");

                                                setTimeout(function() {
                                                    window.location.reload(1);
                                                }, 5000);

                                                $('#body_ent').html(result);


                                            }

                                        });

                                    }
                                </script>


                                <%- include("footer"); %>